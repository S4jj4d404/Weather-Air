<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidShare | Advanced Video Sharing Platform</title>
    <base target="_self">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@preline/preline@2.0.0/dist/preline.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/min/moment.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .video-card:hover .video-thumbnail {
            transform: scale(1.03);
        }
        .video-thumbnail {
            transition: transform 0.3s ease;
        }
        .skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateY(0);
        }
        .comment-replies {
            border-left: 2px solid #e5e7eb;
            padding-left: 1rem;
            margin-left: 2rem;
        }
        .dark .comment-replies {
            border-left-color: #374151;
        }
        .player-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }
        .player-container iframe,
        .player-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .sidebar {
            scrollbar-width: thin;
            scrollbar-color: #9ca3af #e5e7eb;
        }
        .dark .sidebar {
            scrollbar-color: #4b5563 #1f2937;
        }
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
        }
        .dark .sidebar::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .dark .sidebar::-webkit-scrollbar-thumb {
            background-color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <div class="bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg flex items-center">
            <span id="toast-message"></span>
            <button id="toast-close" class="ml-4 text-gray-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Navigation -->
    <header class="sticky top-0 z-50 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="#" id="logo" class="flex items-center space-x-2">
                        <i class="fas fa-play-circle text-primary-600 dark:text-primary-500 text-2xl"></i>
                        <span class="text-xl font-bold text-gray-900 dark:text-white">VidShare</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative w-64 hidden md:block">
                        <input type="text" id="search-input" placeholder="Search videos..." 
                            class="w-full px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                        <button id="search-btn" class="absolute right-3 top-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <button id="upload-btn" class="flex items-center space-x-1 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-full transition-colors">
                        <i class="fas fa-upload"></i>
                        <span class="hidden md:inline">Upload</span>
                    </button>
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                    <div class="relative" id="auth-section">
                        <!-- This will be populated by JavaScript based on auth state -->
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="flex max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Sidebar -->
        <div class="hidden md:block w-64 flex-shrink-0 mr-8 sidebar overflow-y-auto h-[calc(100vh-88px)] sticky top-24">
            <div class="space-y-2">
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-home w-5"></i>
                        <span>Home</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-compass w-5"></i>
                        <span>Explore</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-bookmark w-5"></i>
                        <span>Subscriptions</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-music w-5"></i>
                        <span>Music</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-gamepad w-5"></i>
                        <span>Gaming</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-newspaper w-5"></i>
                        <span>News</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-trophy w-5"></i>
                        <span>Sports</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-lightbulb w-5"></i>
                        <span>Learning</span>
                    </a>
                </div>
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-tshirt w-5"></i>
                        <span>Fashion</span>
                    </a>
                </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-800">
                <h3 class="px-3 py-2 text-sm font-semibold text-gray-500 dark:text-gray-400">SUBSCRIPTIONS</h3>
                <div class="space-y-1" id="subscriptions-list">
                    <!-- Subscriptions will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-800">
                <h3 class="px-3 py-2 text-sm font-semibold text-gray-500 dark:text-gray-400">PLAYLISTS</h3>
                <div class="space-y-1" id="playlists-list">
                    <!-- Playlists will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Categories -->
            <div class="flex space-x-2 overflow-x-auto pb-4 mb-6 scrollbar-hide" id="categories">
                <!-- Categories will be populated by JavaScript -->
            </div>

            <!-- Featured Video -->
            <div class="mb-8" id="featured-video-container">
                <!-- Featured video will be populated by JavaScript -->
            </div>

            <!-- Video Grid -->
            <div id="video-section">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="section-title">Recommended Videos</h3>
                    <div class="flex space-x-2" id="sort-options">
                        <button class="px-3 py-1 text-sm rounded-full bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700" data-sort="newest">Newest</button>
                        <button class="px-3 py-1 text-sm rounded-full bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700" data-sort="views">Most Viewed</button>
                        <button class="px-3 py-1 text-sm rounded-full bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700" data-sort="rating">Top Rated</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="video-grid">
                    <!-- Video cards will be inserted here by JavaScript -->
                </div>
                <div class="mt-8 flex justify-center" id="load-more-container">
                    <button id="load-more" class="px-6 py-2 bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 rounded-full">
                        Load More
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-2xl overflow-hidden">
            <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Upload Video</h3>
                <button id="close-upload" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="upload-form">
                    <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center" id="drop-zone">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Drag and drop video files</h4>
                        <p class="text-gray-500 dark:text-gray-400 mb-4">or</p>
                        <input type="file" id="video-file" accept="video/mp4,video/webm,video/ogg" class="hidden">
                        <button type="button" id="select-files-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-full">
                            Select Files
                        </button>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-4">MP4, WebM or OGG. Max 2GB</p>
                        <div id="file-info" class="mt-4 hidden">
                            <p class="text-sm font-medium text-gray-900 dark:text-white" id="file-name"></p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" id="file-size"></p>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2">
                                <div id="upload-progress" class="bg-primary-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 space-y-4">
                        <div>
                            <label for="video-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
                            <input type="text" id="video-title" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div>
                            <label for="video-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                            <textarea id="video-description" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500"></textarea>
                        </div>
                        <div>
                            <label for="video-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                            <select id="video-category" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                                <!-- Categories will be populated by JavaScript -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Thumbnail</label>
                            <div class="border border-gray-300 dark:border-gray-600 rounded-md p-4 bg-gray-50 dark:bg-gray-700/50">
                                <input type="file" id="thumbnail-file" accept="image/*" class="hidden">
                                <button type="button" id="select-thumbnail-btn" class="bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 px-4 py-2 rounded-md">
                                    Select Image
                                </button>
                                <div id="thumbnail-preview" class="mt-2 hidden">
                                    <img id="thumbnail-preview-img" class="max-h-40 rounded-md">
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Visibility</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="visibility-public" name="visibility" value="public" checked class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600">
                                    <label for="visibility-public" class="ml-2 block text-sm text-gray-900 dark:text-white">Public</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="visibility-unlisted" name="visibility" value="unlisted" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600">
                                    <label for="visibility-unlisted" class="ml-2 block text-sm text-gray-900 dark:text-white">Unlisted</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="visibility-private" name="visibility" value="private" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600">
                                    <label for="visibility-private" class="ml-2 block text-sm text-gray-900 dark:text-white">Private</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                        <button type="button" id="cancel-upload" class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                            Cancel
                        </button>
                        <button type="submit" id="submit-upload" class="px-4 py-2 rounded-md bg-primary-600 hover:bg-primary-700 text-white">
                            Upload
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md overflow-hidden">
            <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white" id="auth-modal-title">Sign In</h3>
                <button id="close-auth" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="auth-form">
                    <div class="space-y-4">
                        <div id="name-field" class="hidden">
                            <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                            <input type="text" id="name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                            <input type="email" id="email" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                            <input type="password" id="password" required minlength="6" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div id="confirm-password-field" class="hidden">
                            <label for="confirm-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Confirm Password</label>
                            <input type="password" id="confirm-password" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div class="pt-2">
                            <button type="submit" id="auth-submit" class="w-full px-4 py-2 rounded-md bg-primary-600 hover:bg-primary-700 text-white">
                                Sign In
                            </button>
                        </div>
                        <div class="text-center text-sm text-gray-600 dark:text-gray-400">
                            <span id="auth-toggle-text">Don't have an account? </span>
                            <button type="button" id="auth-toggle-btn" class="text-primary-600 dark:text-primary-500 font-medium">Sign Up</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="video-modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 overflow-y-auto">
        <div class="w-full max-w-6xl">
            <div class="flex justify-end mb-2">
                <button id="close-video" class="text-white hover:text-gray-300">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <!-- Video Player -->
                    <div class="player-container rounded-xl overflow-hidden bg-black">
                        <video id="video-player" controls class="w-full h-full"></video>
                    </div>
                    
                    <!-- Video Info -->
                    <div class="mt-4 bg-gray-800 rounded-lg p-4">
                        <div class="flex items-start justify-between">
                            <div>
                                <h2 class="text-xl font-bold text-white" id="video-modal-title"></h2>
                                <div class="flex items-center space-x-4 mt-2">
                                    <p class="text-gray-400" id="video-modal-views"></p>
                                    <p class="text-gray-400" id="video-modal-date"></p>
                                    <div class="flex items-center space-x-1">
                                        <i class="fas fa-thumbs-up text-gray-400"></i>
                                        <span class="text-gray-400" id="video-modal-likes"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button id="like-btn" class="p-2 rounded-full hover:bg-gray-700 text-gray-400 hover:text-white flex items-center space-x-1">
                                    <i class="fas fa-thumbs-up"></i>
                                </button>
                                <button id="dislike-btn" class="p-2 rounded-full hover:bg-gray-700 text-gray-400 hover:text-white flex items-center space-x-1">
                                    <i class="fas fa-thumbs-down"></i>
                                </button>
                                <button id="share-btn" class="p-2 rounded-full hover:bg-gray-700 text-gray-400 hover:text-white flex items-center space-x-1">
                                    <i class="fas fa-share"></i>
                                    <span>Share</span>
                                </button>
                                <button id="save-btn" class="p-2 rounded-full hover:bg-gray-700 text-gray-400 hover:text-white flex items-center space-x-1">
                                    <i class="fas fa-bookmark"></i>
                                    <span>Save</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Channel Info -->
                        <div class="flex items-center mt-4 pt-4 border-t border-gray-700">
                            <div class="flex-shrink-0 mr-3">
                                <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-white">
                                    <i class="fas fa-user" id="channel-avatar"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-white" id="video-modal-channel"></p>
                                        <p class="text-sm text-gray-400" id="channel-subs"></p>
                                    </div>
                                    <button id="subscribe-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-full">
                                        Subscribe
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Video Description -->
                        <div class="mt-4 p-3 bg-gray-700 rounded-lg">
                            <div class="flex items-center space-x-2 text-sm text-gray-400 mb-2">
                                <span id="video-modal-date2"></span>
                                <span>•</span>
                                <span id="video-modal-category"></span>
                            </div>
                            <p class="text-white whitespace-pre-line" id="video-modal-description"></p>
                        </div>
                        
                        <!-- Comments -->
                        <div class="mt-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">
                                    <span id="comments-count">0</span> Comments
                                </h3>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-sort text-gray-400"></i>
                                    <span class="text-sm text-gray-400">Sort by</span>
                                </div>
                            </div>
                            
                            <!-- Add Comment -->
                            <div class="flex mb-6" id="add-comment-container">
                                <div class="flex-shrink-0 mr-3">
                                    <div class="w-9 h-9 rounded-full bg-gray-700 flex items-center justify-center text-white">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <input type="text" id="comment-input" placeholder="Add a comment..." class="w-full px-3 py-2 bg-transparent border-b border-gray-600 text-white focus:outline-none focus:border-white">
                                    <div class="flex justify-end mt-2 hidden" id="comment-buttons">
                                        <button id="cancel-comment" class="px-4 py-1 text-gray-400 hover:text-white mr-2">Cancel</button>
                                        <button id="submit-comment" class="px-4 py-1 bg-primary-600 hover:bg-primary-700 text-white rounded-full">Comment</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Comments List -->
                            <div class="space-y-4" id="comments-list">
                                <!-- Comments will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recommended Videos -->
                <div class="lg:col-span-1">
                    <div class="bg-gray-800 rounded-lg p-4 sticky top-4">
                        <h3 class="text-lg font-semibold text-white mb-4">Up next</h3>
                        <div class="space-y-4" id="recommended-videos">
                            <!-- Recommended videos will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md overflow-hidden">
            <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Share</h3>
                <button id="close-share" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="flex items-center space-x-2 mb-6">
                    <input type="text" id="share-link" readonly class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md bg-white dark:bg-gray-700 focus:outline-none text-gray-900 dark:text-white">
                    <button id="copy-link" class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-r-md">
                        Copy
                    </button>
                </div>
                <div class="grid grid-cols-4 gap-4 text-center">
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fab fa-facebook text-blue-600 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">Facebook</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fab fa-twitter text-blue-400 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">Twitter</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fab fa-whatsapp text-green-500 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">WhatsApp</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fab fa-reddit text-orange-500 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">Reddit</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fab fa-linkedin text-blue-700 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">LinkedIn</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fab fa-telegram text-blue-500 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">Telegram</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-envelope text-gray-600 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">Email</span>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-link text-gray-600 text-2xl mb-1"></i>
                        <span class="text-xs text-gray-700 dark:text-gray-300">Copy link</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Playlist Modal -->
    <div id="playlist-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md overflow-hidden">
            <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Save to playlist</h3>
                <button id="close-playlist" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <input type="text" id="new-playlist-name" placeholder="Create new playlist" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500">
                </div>
                <div class="space-y-2 max-h-64 overflow-y-auto" id="playlist-options">
                    <!-- Playlist options will be populated by JavaScript -->
                </div>
                <div class="mt-4 flex justify-end">
                    <button id="save-to-playlist" class="px-4 py-2 rounded-md bg-primary-600 hover:bg-primary-700 text-white">
                        Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        const state = {
            currentUser: null,
            videos: [],
            categories: [
                { id: 'all', name: 'All' },
                { id: 'music', name: 'Music' },
                { id: 'gaming', name: 'Gaming' },
                { id: 'news', name: 'News' },
                { id: 'live', name: 'Live' },
                { id: 'sports', name: 'Sports' },
                { id: 'learning', name: 'Learning' },
                { id: 'fashion', name: 'Fashion' },
                { id: 'tech', name: 'Technology' },
                { id: 'cooking', name: 'Cooking' }
            ],
            subscriptions: [],
            playlists: [],
            featuredVideo: null,
            currentCategory: 'all',
            currentSort: 'newest',
            currentPage: 1,
            isLoading: false,
            isAuthenticated: false,
            authMode: 'signin', // 'signin' or 'signup'
            currentVideo: null,
            comments: [],
            likedVideos: [],
            dislikedVideos: [],
            subscribedChannels: [],
            savedVideos: []
        };

        // DOM elements
        const videoGrid = document.getElementById('video-grid');
        const uploadBtn = document.getElementById('upload-btn');
        const uploadModal = document.getElementById('upload-modal');
        const closeUpload = document.getElementById('close-upload');
        const cancelUpload = document.getElementById('cancel-upload');
        const themeToggle = document.getElementById('theme-toggle');
        const authSection = document.getElementById('auth-section');
        const authModal = document.getElementById('auth-modal');
        const closeAuth = document.getElementById('close-auth');
        const authForm = document.getElementById('auth-form');
        const authToggleBtn = document.getElementById('auth-toggle-btn');
        const authToggleText = document.getElementById('auth-toggle-text');
        const authModalTitle = document.getElementById('auth-modal-title');
        const authSubmit = document.getElementById('auth-submit');
        const nameField = document.getElementById('name-field');
        const confirmPasswordField = document.getElementById('confirm-password-field');
        const videoModal = document.getElementById('video-modal');
        const closeVideo = document.getElementById('close-video');
        const videoPlayer = document.getElementById('video-player');
        const videoModalTitle = document.getElementById('video-modal-title');
        const videoModalViews = document.getElementById('video-modal-views');
        const videoModalDate = document.getElementById('video-modal-date');
        const videoModalDate2 = document.getElementById('video-modal-date2');
        const videoModalCategory = document.getElementById('video-modal-category');
        const videoModalChannel = document.getElementById('video-modal-channel');
        const videoModalDescription = document.getElementById('video-modal-description');
        const videoModalLikes = document.getElementById('video-modal-likes');
        const channelAvatar = document.getElementById('channel-avatar');
        const channelSubs = document.getElementById('channel-subs');
        const categoriesContainer = document.getElementById('categories');
        const videoCategorySelect = document.getElementById('video-category');
        const sectionTitle = document.getElementById('section-title');
        const sortOptions = document.getElementById('sort-options');
        const loadMoreBtn = document.getElementById('load-more');
        const loadMoreContainer = document.getElementById('load-more-container');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const featuredVideoContainer = document.getElementById('featured-video-container');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const toastClose = document.getElementById('toast-close');
        const uploadForm = document.getElementById('upload-form');
        const selectFilesBtn = document.getElementById('select-files-btn');
        const videoFileInput = document.getElementById('video-file');
        const dropZone = document.getElementById('drop-zone');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const uploadProgress = document.getElementById('upload-progress');
        const videoTitleInput = document.getElementById('video-title');
        const videoDescriptionInput = document.getElementById('video-description');
        const selectThumbnailBtn = document.getElementById('select-thumbnail-btn');
        const thumbnailFileInput = document.getElementById('thumbnail-file');
        const thumbnailPreview = document.getElementById('thumbnail-preview');
        const thumbnailPreviewImg = document.getElementById('thumbnail-preview-img');
        const subscriptionsList = document.getElementById('subscriptions-list');
        const playlistsList = document.getElementById('playlists-list');
        const recommendedVideos = document.getElementById('recommended-videos');
        const commentsList = document.getElementById('comments-list');
        const commentsCount = document.getElementById('comments-count');
        const commentInput = document.getElementById('comment-input');
        const commentButtons = document.getElementById('comment-buttons');
        const cancelComment = document.getElementById('cancel-comment');
        const submitComment = document.getElementById('submit-comment');
        const addCommentContainer = document.getElementById('add-comment-container');
        const likeBtn = document.getElementById('like-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        const shareBtn = document.getElementById('share-btn');
        const saveBtn = document.getElementById('save-btn');
        const subscribeBtn = document.getElementById('subscribe-btn');
        const shareModal = document.getElementById('share-modal');
        const closeShare = document.getElementById('close-share');
        const shareLink = document.getElementById('share-link');
        const copyLink = document.getElementById('copy-link');
        const playlistModal = document.getElementById('playlist-modal');
        const closePlaylist = document.getElementById('close-playlist');
        const newPlaylistName = document.getElementById('new-playlist-name');
        const playlistOptions = document.getElementById('playlist-options');
        const saveToPlaylist = document.getElementById('save-to-playlist');

        // Helper functions
        function formatViews(views) {
            if (views >= 1000000) {
                return (views / 1000000).toFixed(1) + 'M';
            } else if (views >= 1000) {
                return (views / 1000).toFixed(1) + 'K';
            }
            return views.toString();
        }

        function formatDate(timestamp) {
            return moment(timestamp).fromNow();
        }

        function formatFullDate(timestamp) {
            return moment(timestamp).format('MMMM D, YYYY');
        }

        function showToast(message, duration = 3000) {
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, duration);
        }

        function getFilteredVideos() {
            let filteredVideos = [...state.videos];
            
            // Filter by category
            if (state.currentCategory !== 'all') {
                filteredVideos = filteredVideos.filter(video => video.category === state.currentCategory);
            }
            
            // Sort videos
            if (state.currentSort === 'newest') {
                filteredVideos.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            } else if (state.currentSort === 'views') {
                filteredVideos.sort((a, b) => b.views - a.views);
            } else if (state.currentSort === 'rating') {
                filteredVideos.sort((a, b) => (b.likes || 0) - (b.dislikes || 0) - ((a.likes || 0) - (a.dislikes || 0)));
            }
            
            return filteredVideos;
        }

        function getRecommendedVideos(currentVideoId) {
            // In a real app, this would be based on algorithm or similar videos
            return state.videos
                .filter(video => video.id !== currentVideoId)
                .sort(() => 0.5 - Math.random())
                .slice(0, 5);
        }

        function isLiked(videoId) {
            return state.likedVideos.includes(videoId);
        }

        function isDisliked(videoId) {
            return state.dislikedVideos.includes(videoId);
        }

        function isSubscribed(channel) {
            return state.subscribedChannels.includes(channel);
        }

        function isSaved(videoId) {
            return state.savedVideos.some(item => item.videoId === videoId);
        }

        // Render functions
        function renderAuthSection() {
            if (state.currentUser) {
                authSection.innerHTML = `
                    <div class="relative">
                        <button id="user-menu" class="flex items-center space-x-2">
                            <div class="w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center text-white">
                                ${state.currentUser.name ? state.currentUser.name.charAt(0).toUpperCase() : 'U'}
                            </div>
                        </button>
                        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-200 dark:border-gray-700">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Your Channel</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Studio</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Settings</a>
                            <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                            <a href="#" id="sign-out-btn" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Sign out</a>
                        </div>
                    </div>
                `;
                
                // Add event listeners for the new elements
                document.getElementById('user-menu').addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.getElementById('user-dropdown').classList.toggle('hidden');
                });
                
                document.getElementById('sign-out-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    signOut();
                });
            } else {
                authSection.innerHTML = `
                    <button id="sign-in-btn" class="px-4 py-2 rounded-md bg-primary-600 hover:bg-primary-700 text-white">
                        Sign In
                    </button>
                `;
                
                document.getElementById('sign-in-btn').addEventListener('click', showAuthModal);
            }
        }

        function renderSubscriptions() {
            if (state.subscriptions.length === 0) {
                subscriptionsList.innerHTML = `
                    <div class="px-3 py-2 text-sm text-gray-500 dark:text-gray-400">
                        No subscriptions yet
                    </div>
                `;
                return;
            }
            
            subscriptionsList.innerHTML = state.subscriptions.map(sub => `
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <div class="w-6 h-6 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-xs">
                            ${sub.charAt(0).toUpperCase()}
                        </div>
                        <span class="truncate">${sub}</span>
                    </a>
                </div>
            `).join('');
        }

        function renderPlaylists() {
            if (state.playlists.length === 0) {
                playlistsList.innerHTML = `
                    <div class="px-3 py-2 text-sm text-gray-500 dark:text-gray-400">
                        No playlists yet
                    </div>
                `;
                return;
            }
            
            playlistsList.innerHTML = state.playlists.map(playlist => `
                <div class="px-2 py-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-gray-900 dark:text-white">
                        <i class="fas fa-list-ul w-5 text-gray-500 dark:text-gray-400"></i>
                        <span class="truncate">${playlist.name}</span>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${playlist.videos.length}</span>
                    </a>
                </div>
            `).join('');
        }

        function renderCategories() {
            categoriesContainer.innerHTML = state.categories.map(category => `
                <button class="px-3 py-1 rounded-full ${state.currentCategory === category.id ? 'bg-primary-600 text-white' : 'bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700'} whitespace-nowrap" 
                    data-category="${category.id}">
                    ${category.name}
                </button>
            `).join('');
            
            // Add event listeners to category buttons
            document.querySelectorAll('[data-category]').forEach(button => {
                button.addEventListener('click', () => {
                    state.currentCategory = button.dataset.category;
                    state.currentPage = 1;
                    renderCategories();
                    renderVideos();
                    updateSectionTitle();
                });
            });
        }

        function renderVideoCategories() {
            videoCategorySelect.innerHTML = state.categories.map(category => `
                <option value="${category.id}">${category.name}</option>
            `).join('');
        }

        function renderVideos() {
            const filteredVideos = getFilteredVideos();
            const videosToShow = filteredVideos.slice(0, state.currentPage * 8);
            
            if (videosToShow.length === 0) {
                videoGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-video-slash text-4xl text-gray-400 mb-4"></i>
                        <h4 class="text-lg font-medium text-gray-900 dark:text-white">No videos found</h4>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Try changing your search or filter criteria</p>
                    </div>
                `;
                loadMoreContainer.classList.add('hidden');
                return;
            }
            
            videoGrid.innerHTML = videosToShow.map(video => `
                <div class="video-card">
                    <div class="block cursor-pointer" data-video-id="${video.id}">
                        <div class="relative rounded-lg overflow-hidden mb-2 video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-full object-cover aspect-video">
                            <div class="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-1.5 py-0.5 rounded">
                                ${video.duration}
                            </div>
                            ${video.isLive ? `<div class="absolute top-2 left-2 bg-red-600 text-white text-xs px-1.5 py-0.5 rounded uppercase font-semibold">Live</div>` : ''}
                        </div>
                        <div class="flex mt-2">
                            <div class="flex-shrink-0 mr-3">
                                <div class="w-9 h-9 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-400">
                                    ${video.channel.charAt(0).toUpperCase()}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white line-clamp-2">${video.title}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${video.channel}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-500">${formatViews(video.views)} views • ${formatDate(video.timestamp)}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Show or hide load more button
            if (filteredVideos.length > videosToShow.length) {
                loadMoreContainer.classList.remove('hidden');
            } else {
                loadMoreContainer.classList.add('hidden');
            }
            
            // Add click handlers to all video cards
            document.querySelectorAll('[data-video-id]').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const videoId = card.dataset.videoId;
                    const video = state.videos.find(v => v.id === videoId);
                    if (video) {
                        playVideo(video);
                    }
                });
            });
        }

        function renderFeaturedVideo() {
            const featured = state.videos.find(v => v.isLive) || 
                            [...state.videos].sort((a, b) => b.views - a.views)[0];
            
            if (featured) {
                state.featuredVideo = featured;
                featuredVideoContainer.innerHTML = `
                    <div class="relative rounded-xl overflow-hidden bg-gray-200 dark:bg-gray-800 aspect-video">
                        <img src="${featured.thumbnail}" alt="${featured.title}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end p-6">
                            <div>
                                ${featured.isLive ? `<span class="bg-red-600 text-white text-xs px-2 py-1 rounded uppercase font-semibold">Live</span>` : ''}
                                <h2 class="text-2xl md:text-3xl font-bold text-white mt-2">${featured.title}</h2>
                                <p class="text-gray-300 mt-1">${formatViews(featured.views)} views • ${featured.isLive ? '15K watching now' : formatDate(featured.timestamp)}</p>
                                <button class="mt-4 bg-white text-gray-900 px-4 py-2 rounded-full font-medium hover:bg-gray-200 transition-colors" data-video-id="${featured.id}">
                                    <i class="fas fa-play mr-2"></i> Watch Now
                                </button>
                            </div>
                        </div>
                        <div class="absolute top-4 right-4">
                            <button class="p-2 bg-black/50 rounded-full text-white hover:bg-black/70">
                                <i class="fas fa-volume-up"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // Add click handler to featured video button
                document.querySelector('[data-video-id]').addEventListener('click', (e) => {
                    e.preventDefault();
                    playVideo(featured);
                });
            } else {
                featuredVideoContainer.innerHTML = '';
            }
        }

        function renderRecommendedVideos() {
            if (!state.currentVideo) return;
            
            const recommended = getRecommendedVideos(state.currentVideo.id);
            recommendedVideos.innerHTML = recommended.map(video => `
                <div class="flex cursor-pointer" data-video-id="${video.id}">
                    <div class="flex-shrink-0 w-40 h-24 relative rounded overflow-hidden">
                        <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-full object-cover">
                        <div class="absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1 py-0.5 rounded">
                            ${video.duration}
                        </div>
                    </div>
                    <div class="ml-2 flex-1">
                        <h4 class="text-sm font-medium text-white line-clamp-2">${video.title}</h4>
                        <p class="text-xs text-gray-400 mt-1">${video.channel}</p>
                        <p class="text-xs text-gray-500">${formatViews(video.views)} views • ${formatDate(video.timestamp)}</p>
                    </div>
                </div>
            `).join('');
            
            // Add click handlers to recommended videos
            document.querySelectorAll('#recommended-videos [data-video-id]').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const videoId = card.dataset.videoId;
                    const video = state.videos.find(v => v.id === videoId);
                    if (video) {
                        playVideo(video);
                    }
                });
            });
        }

        function renderComments() {
            if (state.comments.length === 0) {
                commentsList.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        No comments yet
                    </div>
                `;
                commentsCount.textContent = '0';
                return;
            }
            
            commentsCount.textContent = state.comments.length.toString();
            
            commentsList.innerHTML = state.comments.map(comment => `
                <div class="flex mb-4" data-comment-id="${comment.id}">
                    <div class="flex-shrink-0 mr-3">
                        <div class="w-9 h-9 rounded-full bg-gray-700 flex items-center justify-center text-white">
                            ${comment.author.charAt(0).toUpperCase()}
                        </div>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center">
                            <p class="text-sm font-medium text-white">${comment.author}</p>
                            <p class="text-xs text-gray-400 ml-2">${formatDate(comment.timestamp)}</p>
                        </div>
                        <p class="text-sm text-white mt-1">${comment.text}</p>
                        <div class="flex items-center mt-2 text-xs text-gray-400">
                            <button class="flex items-center hover:text-white" data-action="like">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                <span>${comment.likes || 0}</span>
                            </button>
                            <button class="flex items-center ml-4 hover:text-white" data-action="dislike">
                                <i class="fas fa-thumbs-down mr-1"></i>
                            </button>
                            <button class="ml-4 hover:text-white" data-action="reply">Reply</button>
                        </div>
                        
                        ${comment.replies && comment.replies.length > 0 ? `
                            <div class="comment-replies mt-4">
                                ${comment.replies.map(reply => `
                                    <div class="flex mb-4" data-comment-id="${reply.id}">
                                        <div class="flex-shrink-0 mr-3">
                                            <div class="w-9 h-9 rounded-full bg-gray-700 flex items-center justify-center text-white">
                                                ${reply.author.charAt(0).toUpperCase()}
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center">
                                                <p class="text-sm font-medium text-white">${reply.author}</p>
                                                <p class="text-xs text-gray-400 ml-2">${formatDate(reply.timestamp)}</p>
                                            </div>
                                            <p class="text-sm text-white mt-1">${reply.text}</p>
                                            <div class="flex items-center mt-2 text-xs text-gray-400">
                                                <button class="flex items-center hover:text-white" data-action="like">
                                                    <i class="fas fa-thumbs-up mr-1"></i>
                                                    <span>${reply.likes || 0}</span>
                                                </button>
                                                <button class="flex items-center ml-4 hover:text-white" data-action="dislike">
                                                    <i class="fas fa-thumbs-down mr-1"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to comment actions
            document.querySelectorAll('[data-action="like"]').forEach(button => {
                button.addEventListener('click', (e) => {
                    const commentId = e.target.closest('[data-comment-id]').dataset.commentId;
                    likeComment(commentId);
                });
            });
            
            document.querySelectorAll('[data-action="dislike"]').forEach(button => {
                button.addEventListener('click', (e) => {
                    const commentId = e.target.closest('[data-comment-id]').dataset.commentId;
                    dislikeComment(commentId);
                });
            });
            
            document.querySelectorAll('[data-action="reply"]').forEach(button => {
                button.addEventListener('click', (e) => {
                    const commentId = e.target.closest('[data-comment-id]').dataset.commentId;
                    // In a real app, this would show a reply form
                    showToast('Reply functionality would be implemented here');
                });
            });
        }

        function renderPlaylistOptions() {
            playlistOptions.innerHTML = state.playlists.map(playlist => `
                <div class="flex items-center">
                    <input type="checkbox" id="playlist-${playlist.id}" value="${playlist.id}" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600 rounded">
                    <label for="playlist-${playlist.id}" class="ml-2 block text-sm text-gray-900 dark:text-white">${playlist.name} (${playlist.videos.length})</label>
                </div>
            `).join('');
            
            // Check if current video is already in any playlist
            if (state.currentVideo) {
                state.playlists.forEach(playlist => {
                    const checkbox = document.getElementById(`playlist-${playlist.id}`);
                    if (checkbox && playlist.videos.some(v => v.videoId === state.currentVideo.id)) {
                        checkbox.checked = true;
                    }
                });
            }
        }

        function updateSectionTitle() {
            if (state.currentCategory === 'all') {
                sectionTitle.textContent = 'Recommended Videos';
            } else {
                const category = state.categories.find(c => c.id === state.currentCategory);
                sectionTitle.textContent = `${category.name} Videos`;
            }
        }

        function playVideo(video) {
            state.currentVideo = video;
            
            // Update video metadata
            videoModalTitle.textContent = video.title;
            videoModalViews.textContent = `${formatViews(video.views)} views`;
            videoModalDate.textContent = formatDate(video.timestamp);
            videoModalDate2.textContent = formatFullDate(video.timestamp);
            videoModalChannel.textContent = video.channel;
            videoModalDescription.textContent = video.description;
            videoModalLikes.textContent = formatViews(video.likes || 0);
            channelAvatar.textContent = video.channel.charAt(0).toUpperCase();
            channelSubs.textContent = `${Math.floor(Math.random() * 10) + 1}M subscribers`;
            
            // Find category name
            const category = state.categories.find(c => c.id === video.category);
            videoModalCategory.textContent = category ? category.name : '';
            
            // Update like/dislike buttons
            updateLikeDislikeButtons();
            
            // Update subscribe button
            updateSubscribeButton();
            
            // Update save button
            updateSaveButton();
            
            // Set video source
            videoPlayer.src = video.videoUrl;
            
            // Show modal
            videoModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Load comments
            loadComments(video.id);
            
            // Load recommended videos
            renderRecommendedVideos();
            
            // Play the video
            setTimeout(() => {
                videoPlayer.play().catch(e => console.log('Autoplay prevented:', e));
            }, 300);
            
            // Increment view count (simulated)
            video.views += 1;
        }

        function updateLikeDislikeButtons() {
            if (!state.currentVideo) return;
            
            if (isLiked(state.currentVideo.id)) {
                likeBtn.innerHTML = '<i class="fas fa-thumbs-up text-primary-500"></i>';
                likeBtn.classList.add('text-primary-500');
                dislikeBtn.innerHTML = '<i class="fas fa-thumbs-down"></i>';
                dislikeBtn.classList.remove('text-primary-500');
            } else if (isDisliked(state.currentVideo.id)) {
                likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i>';
                likeBtn.classList.remove('text-primary-500');
                dislikeBtn.innerHTML = '<i class="fas fa-thumbs-down text-primary-500"></i>';
                dislikeBtn.classList.add('text-primary-500');
            } else {
                likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i>';
                likeBtn.classList.remove('text-primary-500');
                dislikeBtn.innerHTML = '<i class="fas fa-thumbs-down"></i>';
                dislikeBtn.classList.remove('text-primary-500');
            }
        }

        function updateSubscribeButton() {
            if (!state.currentVideo) return;
            
            if (isSubscribed(state.currentVideo.channel)) {
                subscribeBtn.textContent = 'Subscribed';
                subscribeBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                subscribeBtn.classList.add('bg-gray-600', 'hover:bg-gray-700');
            } else {
                subscribeBtn.textContent = 'Subscribe';
                subscribeBtn.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                subscribeBtn.classList.add('bg-red-600', 'hover:bg-red-700');
            }
        }

        function updateSaveButton() {
            if (!state.currentVideo) return;
            
            if (isSaved(state.currentVideo.id)) {
                saveBtn.innerHTML = '<i class="fas fa-bookmark text-primary-500"></i><span>Saved</span>';
            } else {
                saveBtn.innerHTML = '<i class="fas fa-bookmark"></i><span>Save</span>';
            }
        }

        function showAuthModal() {
            authModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function hideAuthModal() {
            authModal.classList.remove('hidden');
            document.body.style.overflow = '';
        }

        function toggleAuthMode() {
            if (state.authMode === 'signin') {
                state.authMode = 'signup';
                authModalTitle.textContent = 'Sign Up';
                authSubmit.textContent = 'Sign Up';
                authToggleText.textContent = 'Already have an account? ';
                authToggleBtn.textContent = 'Sign In';
                nameField.classList.remove('hidden');
                confirmPasswordField.classList.remove('hidden');
            } else {
                state.authMode = 'signin';
                authModalTitle.textContent = 'Sign In';
                authSubmit.textContent = 'Sign In';
                authToggleText.textContent = 'Don\'t have an account? ';
                authToggleBtn.textContent = 'Sign Up';
                nameField.classList.add('hidden');
                confirmPasswordField.classList.add('hidden');
            }
        }

        function showShareModal() {
            if (!state.currentVideo) return;
            
            shareLink.value = `${window.location.origin}?v=${state.currentVideo.id}`;
            shareModal.classList.remove('hidden');
        }

        function showPlaylistModal() {
            if (!state.currentVideo) return;
            
            renderPlaylistOptions();
            playlistModal.classList.remove('hidden');
        }

        // Data functions
        function loadComments(videoId) {
            // In a real app, this would fetch comments from an API
            const sampleComments = [
                {
                    id: 'comment1',
                    author: 'TechEnthusiast',
                    text: 'This is an amazing tutorial! I learned so much. Thanks for sharing!',
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    likes: 24,
                    replies: [
                        {
                            id: 'reply1',
                            author: 'VideoCreator',
                            text: 'Thanks for your kind words! Glad you found it helpful.',
                            timestamp: new Date(Date.now() - 1800000).toISOString(),
                            likes: 5
                        }
                    ]
                },
                {
                    id: 'comment2',
                    author: 'CodeNewbie',
                    text: 'Could you explain more about the part at 5:30? I got a bit confused there.',
                    timestamp: new Date(Date.now() - 86400000).toISOString(),
                    likes: 8,
                    replies: []
                },
                {
                    id: 'comment3',
                    author: 'DevPro',
                    text: 'Nice content! I would suggest covering error handling in your next video.',
                    timestamp: new Date(Date.now() - 172800000).toISOString(),
                    likes: 15,
                    replies: []
                }
            ];
            
            state.comments = sampleComments;
            renderComments();
        }

        function likeComment(commentId) {
            // In a real app, this would call an API
            const comment = state.comments.find(c => c.id === commentId) || 
                           state.comments.flatMap(c => c.replies || []).find(r => r.id === commentId);
            
            if (comment) {
                comment.likes = (comment.likes || 0) + 1;
                renderComments();
                showToast('Comment liked');
            }
        }

        function dislikeComment(commentId) {
            // In a real app, this would call an API
            showToast('Comment disliked');
        }

        function addComment(text) {
            if (!text.trim() || !state.currentUser || !state.currentVideo) return;
            
            const newComment = {
                id: `comment-${Date.now()}`,
                author: state.currentUser.name || 'Anonymous',
                text: text,
                timestamp: new Date().toISOString(),
                likes: 0,
                replies: []
            };
            
            state.comments.unshift(newComment);
            renderComments();
            commentInput.value = '';
            commentButtons.classList.add('hidden');
            
            // In a real app, this would post to an API
            showToast('Comment added');
        }

        function likeVideo() {
            if (!state.currentVideo || !state.currentUser) {
                showToast('Please sign in to like videos');
                return;
            }
            
            const videoId = state.currentVideo.id;
            
            if (isLiked(videoId)) {
                // Remove like
                state.likedVideos = state.likedVideos.filter(id => id !== videoId);
                state.currentVideo.likes = (state.currentVideo.likes || 1) - 1;
            } else {
                // Add like
                state.likedVideos.push(videoId);
                state.currentVideo.likes = (state.currentVideo.likes || 0) + 1;
                
                // Remove dislike if exists
                if (isDisliked(videoId)) {
                    state.dislikedVideos = state.dislikedVideos.filter(id => id !== videoId);
                    state.currentVideo.dislikes = (state.currentVideo.dislikes || 1) - 1;
                }
            }
            
            updateLikeDislikeButtons();
            videoModalLikes.textContent = formatViews(state.currentVideo.likes || 0);
        }

        function dislikeVideo() {
            if (!state.currentVideo || !state.currentUser) {
                showToast('Please sign in to dislike videos');
                return;
            }
            
            const videoId = state.currentVideo.id;
            
            if (isDisliked(videoId)) {
                // Remove dislike
                state.dislikedVideos = state.dislikedVideos.filter(id => id !== videoId);
                state.currentVideo.dislikes = (state.currentVideo.dislikes || 1) - 1;
            } else {
                // Add dislike
                state.dislikedVideos.push(videoId);
                state.currentVideo.dislikes = (state.currentVideo.dislikes || 0) + 1;
                
                // Remove like if exists
                if (isLiked(videoId)) {
                    state.likedVideos = state.likedVideos.filter(id => id !== videoId);
                    state.currentVideo.likes = (state.currentVideo.likes || 1) - 1;
                }
            }
            
            updateLikeDislikeButtons();
        }

        function toggleSubscribe() {
            if (!state.currentVideo || !state.currentUser) {
                showToast('Please sign in to subscribe');
                return;
            }
            
            const channel = state.currentVideo.channel;
            
            if (isSubscribed(channel)) {
                // Unsubscribe
                state.subscribedChannels = state.subscribedChannels.filter(c => c !== channel);
                showToast(`Unsubscribed from ${channel}`);
            } else {
                // Subscribe
                state.subscribedChannels.push(channel);
                showToast(`Subscribed to ${channel}`);
                
                // Add to subscriptions list if not already there
                if (!state.subscriptions.includes(channel)) {
                    state.subscriptions.push(channel);
                    renderSubscriptions();
                }
            }
            
            updateSubscribeButton();
        }

        function toggleSaveVideo() {
            if (!state.currentVideo || !state.currentUser) {
                showToast('Please sign in to save videos');
                return;
            }
            
            const videoId = state.currentVideo.id;
            
            if (isSaved(videoId)) {
                // Remove from saved
                state.savedVideos = state.savedVideos.filter(v => v.videoId !== videoId);
                showToast('Video removed from saved');
            } else {
                showPlaylistModal();
                return;
            }
            
            updateSaveButton();
        }

        function saveToPlaylists() {
            if (!state.currentVideo) return;
            
            const videoId = state.currentVideo.id;
            const newPlaylistNameValue = newPlaylistName.value.trim();
            
            // Create new playlist if name provided
            if (newPlaylistNameValue) {
                const newPlaylist = {
                    id: `playlist-${Date.now()}`,
                    name: newPlaylistNameValue,
                    videos: [{ videoId, timestamp: new Date().toISOString() }]
                };
                state.playlists.push(newPlaylist);
                newPlaylistName.value = '';
                showToast(`Created new playlist "${newPlaylistNameValue}"`);
            }
            
            // Add to selected playlists
            document.querySelectorAll('#playlist-options input[type="checkbox"]').forEach(checkbox => {
                const playlistId = checkbox.value;
                const playlist = state.playlists.find(p => p.id === playlistId);
                
                if (playlist) {
                    if (checkbox.checked && !playlist.videos.some(v => v.videoId === videoId)) {
                        playlist.videos.push({ videoId, timestamp: new Date().toISOString() });
                    } else if (!checkbox.checked) {
                        playlist.videos = playlist.videos.filter(v => v.videoId !== videoId);
                    }
                }
            });
            
            // Update saved videos list
            const isInAnyPlaylist = state.playlists.some(p => p.videos.some(v => v.videoId === videoId));
            if (isInAnyPlaylist && !isSaved(videoId)) {
                state.savedVideos.push({ videoId, timestamp: new Date().toISOString() });
            } else if (!isInAnyPlaylist && isSaved(videoId)) {
                state.savedVideos = state.savedVideos.filter(v => v.videoId !== videoId);
            }
            
            // Update UI
            updateSaveButton();
            renderPlaylists();
            playlistModal.classList.add('hidden');
            showToast('Video saved to playlist');
        }

        // Event handlers
        function handleSignIn(email, password) {
            // In a real app, this would call your authentication API
            console.log('Signing in with:', email, password);
            
            // Simulate API call
            setTimeout(() => {
                state.currentUser = {
                    id: 'user123',
                    email: email,
                    name: email.split('@')[0]
                };
                state.isAuthenticated = true;
                
                // Generate some sample data for the user
                state.subscriptions = ['CodeMaster', 'DevLife', 'WebDesignPro'];
                state.playlists = [
                    {
                        id: 'playlist1',
                        name: 'Favorites',
                        videos: [
                            { videoId: '1', timestamp: new Date().toISOString() },
                            { videoId: '3', timestamp: new Date().toISOString() }
                        ]
                    },
                    {
                        id: 'playlist2',
                        name: 'Watch Later',
                        videos: [
                            { videoId: '5', timestamp: new Date().toISOString() },
                            { videoId: '8', timestamp: new Date().toISOString() }
                        ]
                    }
                ];
                state.likedVideos = ['1', '3'];
                state.subscribedChannels = ['CodeMaster', 'DevLife', 'WebDesignPro'];
                state.savedVideos = [
                    { videoId: '1', timestamp: new Date().toISOString() },
                    { videoId: '3', timestamp: new Date().toISOString() },
                    { videoId: '5', timestamp: new Date().toISOString() }
                ];
                
                renderAuthSection();
                renderSubscriptions();
                renderPlaylists();
                hideAuthModal();
                showToast('Successfully signed in');
                
                // Enable upload button
                uploadBtn.disabled = false;
            }, 1000);
        }

        function handleSignUp(name, email, password) {
            // In a real app, this would call your authentication API
            console.log('Signing up with:', name, email, password);
            
            // Simulate API call
            setTimeout(() => {
                state.currentUser = {
                    id: 'user123',
                    email: email,
                    name: name
                };
                state.isAuthenticated = true;
                
                // Initialize empty user data
                state.subscriptions = [];
                state.playlists = [];
                state.likedVideos = [];
                state.subscribedChannels = [];
                state.savedVideos = [];
                
                renderAuthSection();
                renderSubscriptions();
                renderPlaylists();
                hideAuthModal();
                showToast('Account created successfully');
                
                // Enable upload button
                uploadBtn.disabled = false;
            }, 1000);
        }

        function signOut() {
            state.currentUser = null;
            state.isAuthenticated = false;
            
            renderAuthSection();
            showToast('Successfully signed out');
            
            // Disable upload button
            uploadBtn.disabled = true;
        }

        function handleVideoUpload(formData) {
            // In a real app, this would upload to your backend
            console.log('Uploading video:', formData);
            
            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                uploadProgress.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Add the new video to the list
                    const newVideo = {
                        id: `new-${Date.now()}`,
                        title: formData.get('title'),
                        channel: state.currentUser?.name || 'Anonymous',
                        views: 0,
                        timestamp: new Date().toISOString(),
                        duration: '10:00', // This would be calculated from the actual video
                        thumbnail: formData.get('thumbnail') ? URL.createObjectURL(formData.get('thumbnail')) : 'https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80',
                        videoUrl: 'https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4',
                        description: formData.get('description') || '',
                        category: formData.get('category') || 'all',
                        visibility: formData.get('visibility') || 'public'
                    };
                    
                    state.videos.unshift(newVideo);
                    
                    // Reset form and hide modal
                    uploadForm.reset();
                    fileInfo.classList.add('hidden');
                    thumbnailPreview.classList.add('hidden');
                    uploadModal.classList.add('hidden');
                    
                    // Render videos with the new one
                    renderFeaturedVideo();
                    renderVideos();
                    
                    showToast('Video uploaded successfully!');
                }
            }, 200);
        }

        function handleSearch(query) {
            // In a real app, this would call your search API
            console.log('Searching for:', query);
            
            // Simulate search by filtering
            const filtered = state.videos.filter(video => 
                video.title.toLowerCase().includes(query.toLowerCase()) || 
                video.channel.toLowerCase().includes(query.toLowerCase())
            );
            
            // Update UI
            videoGrid.innerHTML = filtered.map(video => `
                <div class="video-card">
                    <div class="block cursor-pointer" data-video-id="${video.id}">
                        <div class="relative rounded-lg overflow-hidden mb-2 video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-full object-cover aspect-video">
                            <div class="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-1.5 py-0.5 rounded">
                                ${video.duration}
                            </div>
                        </div>
                        <div class="flex mt-2">
                            <div class="flex-shrink-0 mr-3">
                                <div class="w-9 h-9 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-400">
                                    ${video.channel.charAt(0).toUpperCase()}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white line-clamp-2">${video.title}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${video.channel}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-500">${formatViews(video.views)} views • ${formatDate(video.timestamp)}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            sectionTitle.textContent = `Search results for "${query}"`;
            loadMoreContainer.classList.add('hidden');
            
            // Reattach click handlers
            document.querySelectorAll('[data-video-id]').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const videoId = card.dataset.videoId;
                    const video = state.videos.find(v => v.id === videoId);
                    if (video) {
                        playVideo(video);
                    }
                });
            });
        }

        // Initialize the app
        function init() {
            // Load sample data
            state.videos = generateSampleVideos();
            
            // Set up event listeners
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            });
            
            // Check for saved theme preference
            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            
            // Upload modal
            uploadBtn.addEventListener('click', () => {
                if (!state.isAuthenticated) {
                    showAuthModal();
                    showToast('Please sign in to upload videos');
                    return;
                }
                uploadModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
            
            closeUpload.addEventListener('click', () => {
                uploadModal.classList.add('hidden');
                document.body.style.overflow = '';
            });
            
            cancelUpload.addEventListener('click', () => {
                uploadModal.classList.add('hidden');
                document.body.style.overflow = '';
            });
            
            // Video modal
            closeVideo.addEventListener('click', () => {
                videoPlayer.pause();
                videoModal.classList.add('hidden');
                document.body.style.overflow = '';
            });
            
            // Auth modal
            closeAuth.addEventListener('click', hideAuthModal);
            authToggleBtn.addEventListener('click', toggleAuthMode);
            
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (state.authMode === 'signin') {
                    handleSignIn(email, password);
                } else {
                    const name = document.getElementById('name').value;
                    const confirmPassword = document.getElementById('confirm-password').value;
                    
                    if (password !== confirmPassword) {
                        showToast('Passwords do not match');
                        return;
                    }
                    
                    handleSignUp(name, email, password);
                }
            });
            
            // File upload handling
            selectFilesBtn.addEventListener('click', () => {
                videoFileInput.click();
            });
            
            videoFileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    fileName.textContent = file.name;
                    fileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(2)} MB`;
                    fileInfo.classList.remove('hidden');
                }
            });
            
            // Thumbnail selection
            selectThumbnailBtn.addEventListener('click', () => {
                thumbnailFileInput.click();
            });
            
            thumbnailFileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        thumbnailPreviewImg.src = event.target.result;
                        thumbnailPreview.classList.remove('hidden');
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
            }
            
            function unhighlight() {
                dropZone.classList.remove('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    videoFileInput.files = files;
                    const file = files[0];
                    fileName.textContent = file.name;
                    fileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(2)} MB`;
                    fileInfo.classList.remove('hidden');
                }
            }
            
            // Upload form submission
            uploadForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const formData = new FormData();
                formData.append('title', videoTitleInput.value);
                formData.append('description', videoDescriptionInput.value);
                formData.append('category', videoCategorySelect.value);
                formData.append('visibility', document.querySelector('input[name="visibility"]:checked').value);
                
                if (videoFileInput.files.length > 0) {
                    formData.append('video', videoFileInput.files[0]);
                }
                
                if (thumbnailFileInput.files.length > 0) {
                    formData.append('thumbnail', thumbnailFileInput.files[0]);
                }
                
                handleVideoUpload(formData);
            });
            
            // Load more videos
            loadMoreBtn.addEventListener('click', () => {
                state.currentPage += 1;
                renderVideos();
            });
            
            // Sort options
            sortOptions.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    state.currentSort = e.target.dataset.sort;
                    state.currentPage = 1;
                    
                    // Update button styles
                    document.querySelectorAll('#sort-options button').forEach(btn => {
                        btn.classList.remove('bg-primary-600', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-800');
                    });
                    
                    e.target.classList.remove('bg-gray-200', 'dark:bg-gray-800');
                    e.target.classList.add('bg-primary-600', 'text-white');
                    
                    renderVideos();
                }
            });
            
            // Search functionality
            searchBtn.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    handleSearch(query);
                }
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        handleSearch(query);
                    }
                }
            });
            
            // Toast close button
            toastClose.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => toast.classList.add('hidden'), 300);
            });
            
            // Comment functionality
            commentInput.addEventListener('focus', () => {
                if (state.isAuthenticated) {
                    commentButtons.classList.remove('hidden');
                }
            });
            
            commentInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && state.isAuthenticated) {
                    addComment(commentInput.value);
                }
            });
            
            cancelComment.addEventListener('click', () => {
                commentInput.value = '';
                commentButtons.classList.add('hidden');
            });
            
            submitComment.addEventListener('click', () => {
                addComment(commentInput.value);
            });
            
            // Video interaction buttons
            likeBtn.addEventListener('click', likeVideo);
            dislikeBtn.addEventListener('click', dislikeVideo);
            shareBtn.addEventListener('click', showShareModal);
            saveBtn.addEventListener('click', toggleSaveVideo);
            subscribeBtn.addEventListener('click', toggleSubscribe);
            
            // Share modal
            closeShare.addEventListener('click', () => {
                shareModal.classList.add('hidden');
            });
            
            copyLink.addEventListener('click', () => {
                shareLink.select();
                document.execCommand('copy');
                showToast('Link copied to clipboard');
            });
            
            // Playlist modal
            closePlaylist.addEventListener('click', () => {
                playlistModal.classList.add('hidden');
            });
            
            saveToPlaylist.addEventListener('click', saveToPlaylists);
            
            // Initial renders
            renderAuthSection();
            renderCategories();
            renderVideoCategories();
            renderFeaturedVideo();
            renderVideos();
            updateSectionTitle();
            
            // Disable upload button if not authenticated
            uploadBtn.disabled = !state.isAuthenticated;
            
            // Hide comment buttons initially
            commentButtons.classList.add('hidden');
        }
        
        // Generate sample videos
        function generateSampleVideos() {
            const sampleVideos = [
                {
                    id: '1',
                    title: "How to Build a Modern Web App with React",
                    channel: "CodeMaster",
                    views: 245000,
                    timestamp: "2023-06-15T10:30:00Z",
                    duration: "12:45",
                    thumbnail: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "In this tutorial, we'll build a modern web application using React, Tailwind CSS, and Firebase. Learn how to create responsive layouts, manage state, and connect to a backend.\n\nTimestamps:\n00:00 Introduction\n02:15 Project Setup\n05:30 Creating Components\n08:45 State Management\n11:20 Connecting to Firebase",
                    category: "tech",
                    likes: 1200,
                    dislikes: 25
                },
                {
                    id: '2',
                    title: "Morning Routine of Successful Developers",
                    channel: "DevLife",
                    views: 1200000,
                    timestamp: "2023-05-28T08:15:00Z",
                    duration: "8:22",
                    thumbnail: "https://images.unsplash.com/photo-1498050108023-c5249f456dfb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2059&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "What does the morning routine of successful developers look like? We interviewed 10 top developers to find out their secrets for productivity and focus.",
                    category: "tech",
                    likes: 8500,
                    dislikes: 120
                },
                {
                    id: '3',
                    title: "Learn CSS Grid in 20 Minutes",
                    channel: "WebDesignPro",
                    views: 876000,
                    timestamp: "2023-04-10T14:20:00Z",
                    duration: "18:36",
                    thumbnail: "https://images.unsplash.com/photo-1547658719-da2b51169166?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "CSS Grid is a powerful layout system available in CSS. In this tutorial, you'll learn everything you need to know to start using CSS Grid in your projects.",
                    category: "learning",
                    likes: 6500,
                    dislikes: 80
                },
                {
                    id: '4',
                    title: "Building a Gaming PC - Step by Step Guide",
                    channel: "TechGamer",
                    views: 3400000,
                    timestamp: "2023-01-15T16:45:00Z",
                    duration: "25:12",
                    thumbnail: "https://images.unsplash.com/photo-1593508512255-86ab42a8e620?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2078&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "Complete guide to building your own high-performance gaming PC. We'll walk through selecting components, assembly, and installing software.",
                    category: "gaming",
                    likes: 24500,
                    dislikes: 350
                },
                {
                    id: '5',
                    title: "10 JavaScript Tips You Should Know",
                    channel: "JS Wizards",
                    views: 567000,
                    timestamp: "2023-06-05T11:10:00Z",
                    duration: "10:15",
                    thumbnail: "https://images.unsplash.com/photo-1579403124614-197f69d8187b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "These 10 JavaScript tips will help you write cleaner, more efficient code. Whether you're a beginner or experienced developer, you'll find something useful here.",
                    category: "tech",
                    likes: 4200,
                    dislikes: 60
                },
                {
                    id: '6',
                    title: "Travel Vlog: Exploring Bali's Hidden Gems",
                    channel: "Wanderlust",
                    views: 2100000,
                    timestamp: "2022-07-22T09:30:00Z",
                    duration: "15:42",
                    thumbnail: "https://images.unsplash.com/photo-1518544866335-95dd2664f3e5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "Join us as we explore the hidden gems of Bali - from secret waterfalls to secluded beaches that most tourists never see.",
                    category: "all",
                    likes: 18700,
                    dislikes: 210
                },
                {
                    id: '7',
                    title: "Cooking Italian Pasta from Scratch",
                    channel: "Foodie Adventures",
                    views: 432000,
                    timestamp: "2023-06-18T12:00:00Z",
                    duration: "22:08",
                    thumbnail: "https://images.unsplash.com/photo-1555949258-eb67b1ef0ceb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "Learn how to make authentic Italian pasta from scratch with this step-by-step guide. We'll make the dough, shape it, and prepare a delicious sauce.",
                    category: "cooking",
                    likes: 3800,
                    dislikes: 45
                },
                {
                    id: '8',
                    title: "Photography Tips for Beginners",
                    channel: "Shutter Master",
                    views: 789000,
                    timestamp: "2023-03-12T15:45:00Z",
                    duration: "14:33",
                    thumbnail: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2053&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "Essential photography tips for beginners. Learn about composition, lighting, and camera settings to take your photos to the next level.",
                    category: "learning",
                    likes: 6200,
                    dislikes: 90
                },
                {
                    id: '9',
                    title: "Summer Music Festival 2023 - Live Stream",
                    channel: "MusicLive",
                    views: 3200000,
                    timestamp: "2023-06-10T20:00:00Z",
                    duration: "2:45:12",
                    thumbnail: "https://images.unsplash.com/photo-1574717024453-354dd9d76e43?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "Live stream from the Summer Music Festival 2023 featuring top artists from around the world. Recorded on June 10, 2023.",
                    category: "music",
                    isLive: true,
                    likes: 28900,
                    dislikes: 420
                },
                {
                    id: '10',
                    title: "Yoga for Beginners: 30 Minute Routine",
                    channel: "HealthyLife",
                    views: 654000,
                    timestamp: "2023-05-05T07:15:00Z",
                    duration: "30:00",
                    thumbnail: "https://images.unsplash.com/photo-1545205597-3d9d02c29597?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",
                    videoUrl: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4",
                    description: "Perfect yoga routine for beginners. Follow along with this 30-minute session to improve flexibility, strength, and mindfulness.",
                    category: "all",
                    likes: 5100,
                    dislikes: 70
                }
            ];

            return sampleVideos;
        }

        // Run initialization when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>