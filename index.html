<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather & Air Quality Checker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js">
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --danger-color: #ea4335;
            --warning-color: #fbbc05;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-color: #fff;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #f5f5f5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            position: relative;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            margin-bottom: 20px;
        }

        body.dark-mode .container {
            background-color: rgba(30, 30, 30, 0.9);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode header {
            border-bottom: 1px solid #444;
        }

        h1 {
            font-size: 2rem;
            color: var(--primary-color);
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        body.dark-mode .theme-toggle {
            color: var(--dark-text);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #location-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        body.dark-mode #location-input {
            background-color: var(--dark-card);
            border-color: #444;
            color: var(--dark-text);
        }

        button {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #3367d6;
        }

        .current-weather {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .weather-card {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .weather-card {
            background-color: var(--dark-card);
        }

        .main-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .weather-icon {
            font-size: 3rem;
            margin-right: 20px;
        }

        .temperature {
            font-size: 3rem;
            font-weight: bold;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
        }

        .detail-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .aqi-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin-left: 10px;
        }

        .aqi-good {
            background-color: var(--secondary-color);
        }

        .aqi-moderate {
            background-color: var(--warning-color);
        }

        .aqi-unhealthy {
            background-color: var(--danger-color);
        }

        .forecast-container {
            margin-bottom: 30px;
        }

        .forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
        }

        .tab {
            padding: 8px 15px;
            background-color: #eee;
            border-radius: 5px;
            cursor: pointer;
        }

        body.dark-mode .tab {
            background-color: #333;
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }

        .hourly-forecast {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
        }

        .hour-card {
            min-width: 80px;
            text-align: center;
            padding: 10px;
            background-color: var(--card-color);
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .hour-card {
            background-color: var(--dark-card);
        }

        .daily-forecast {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .day-card {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        body.dark-mode .day-card {
            background-color: var(--dark-card);
        }

        .health-alert {
            background-color: #fff3cd;
            border-left: 5px solid var(--warning-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        body.dark-mode .health-alert {
            background-color: #332c00;
        }

        .alert-danger {
            background-color: #f8d7da;
            border-left-color: var(--danger-color);
        }

        body.dark-mode .alert-danger {
            background-color: #331a1d;
        }

        .alert-success {
            background-color: #d1e7dd;
            border-left-color: var(--secondary-color);
        }

        body.dark-mode .alert-success {
            background-color: #1a3326;
        }

        .saved-cities {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .city-chip {
            padding: 8px 15px;
            background-color: #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        body.dark-mode .city-chip {
            background-color: #333;
        }

        .city-chip .close {
            margin-left: 8px;
            font-size: 0.8rem;
        }

        .additional-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .info-card {
            background-color: var(--dark-card);
        }

        .info-card h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .language-selector {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }

        .language-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .install-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 100;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .current-weather {
                grid-template-columns: 1fr;
            }
            
            .weather-details {
                grid-template-columns: 1fr;
            }
            
            .daily-forecast {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Weather background classes */
        .weather-bg-clear {
            background-image: url('https://images.unsplash.com/photo-1507402012010-82c0377068f0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        .weather-bg-clouds {
            background-image: url('https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        .weather-bg-rain {
            background-image: url('https://images.unsplash.com/photo-1438449805896-28a666819a20?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        .weather-bg-thunderstorm {
            background-image: url('https://images.unsplash.com/photo-1507334446580-43238a0833ac?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        .weather-bg-snow {
            background-image: url('https://images.unsplash.com/photo-1483728642387-6c3bdd6c93e5?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        .weather-bg-mist {
            background-image: url('https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }

        .weather-bg-night {
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        }
    </style>
</head>
<body class="weather-bg-clear">
    <div class="container">
        <header>
            <h1 id="app-title">Weather & Air Quality Checker</h1>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <div class="search-container">
            <input type="text" id="location-input" placeholder="Enter city name or zip code">
            <button id="search-btn"><i class="fas fa-search"></i> Search</button>
            <button id="locate-btn"><i class="fas fa-location-arrow"></i> Current Location</button>
        </div>

        <div id="health-alerts"></div>

        <div class="current-weather">
            <div class="weather-card">
                <div class="main-info">
                    <div class="weather-icon" id="weather-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div>
                        <div class="temperature" id="temperature">--°C</div>
                        <div id="weather-description">--</div>
                        <div id="location">--</div>
                    </div>
                </div>
                <div class="weather-details">
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-tint"></i></div>
                        <div>
                            <div>Humidity</div>
                            <div id="humidity">--%</div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-wind"></i></div>
                        <div>
                            <div>Wind</div>
                            <div id="wind">-- km/h</div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-compass"></i></div>
                        <div>
                            <div>Wind Direction</div>
                            <div id="wind-direction">--</div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-cloud-rain"></i></div>
                        <div>
                            <div>Precipitation</div>
                            <div id="precipitation">--%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="weather-card">
                <h2>Air Quality</h2>
                <div class="weather-details">
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-lungs"></i></div>
                        <div>
                            <div>Air Quality Index</div>
                            <div id="aqi">-- <span class="aqi-indicator aqi-good">Good</span></div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-sun"></i></div>
                        <div>
                            <div>UV Index</div>
                            <div id="uv-index">--</div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-eye"></i></div>
                        <div>
                            <div>Visibility</div>
                            <div id="visibility">-- km</div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-clock"></i></div>
                        <div>
                            <div>Sunrise/Sunset</div>
                            <div id="sun-times">--:-- / --:--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="forecast-container">
            <div class="forecast-header">
                <h2 id="forecast-title">Hourly Forecast</h2>
                <div class="tabs">
                    <div class="tab active" data-tab="hourly">Hourly</div>
                    <div class="tab" data-tab="daily">Daily</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="weather-chart"></canvas>
            </div>

            <div id="hourly-forecast" class="hourly-forecast">
                <!-- Hourly forecast items will be added here -->
            </div>

            <div id="daily-forecast" class="daily-forecast" style="display: none;">
                <!-- Daily forecast items will be added here -->
            </div>
        </div>

        <div class="saved-cities-container">
            <h2>Saved Locations</h2>
            <div class="saved-cities" id="saved-cities">
                <!-- Saved cities will be added here -->
            </div>
        </div>

        <div class="additional-info">
            <div class="info-card">
                <h3>Health Recommendations</h3>
                <div id="health-recommendations">
                    <p>Air quality is good. No special precautions needed.</p>
                </div>
            </div>
            <div class="info-card">
                <h3>Skin Care Tips</h3>
                <div id="skin-care-tips">
                    <p>UV index is moderate. Consider wearing sunscreen.</p>
                </div>
            </div>
            <div class="info-card">
                <h3>Mood Suggestions</h3>
                <div id="mood-suggestions">
                    <p>It's a beautiful day! Great for outdoor activities.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="language-selector">
        <button class="language-btn" id="language-toggle">EN</button>
    </div>

    <div class="install-btn" id="install-btn" style="display: none;">
        <i class="fas fa-download"></i>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let currentLocation = null;
        let savedLocations = JSON.parse(localStorage.getItem('savedLocations')) || [];
        let isEnglish = true;
        let deferredPrompt;
        let weatherChart = null;

        // DOM elements
        const elements = {
            locationInput: document.getElementById('location-input'),
            searchBtn: document.getElementById('search-btn'),
            locateBtn: document.getElementById('locate-btn'),
            temperature: document.getElementById('temperature'),
            weatherDescription: document.getElementById('weather-description'),
            location: document.getElementById('location'),
            humidity: document.getElementById('humidity'),
            wind: document.getElementById('wind'),
            windDirection: document.getElementById('wind-direction'),
            precipitation: document.getElementById('precipitation'),
            weatherIcon: document.getElementById('weather-icon'),
            aqi: document.getElementById('aqi'),
            uvIndex: document.getElementById('uv-index'),
            visibility: document.getElementById('visibility'),
            sunTimes: document.getElementById('sun-times'),
            hourlyForecast: document.getElementById('hourly-forecast'),
            dailyForecast: document.getElementById('daily-forecast'),
            tabs: document.querySelectorAll('.tab'),
            healthAlerts: document.getElementById('health-alerts'),
            healthRecommendations: document.getElementById('health-recommendations'),
            skinCareTips: document.getElementById('skin-care-tips'),
            moodSuggestions: document.getElementById('mood-suggestions'),
            savedCities: document.getElementById('saved-cities'),
            themeToggle: document.getElementById('theme-toggle'),
            languageToggle: document.getElementById('language-toggle'),
            appTitle: document.getElementById('app-title'),
            forecastTitle: document.getElementById('forecast-title'),
            installBtn: document.getElementById('install-btn'),
            body: document.body
        };

        // Event listeners
        elements.searchBtn.addEventListener('click', searchLocation);
        elements.locateBtn.addEventListener('click', getCurrentLocation);
        elements.locationInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchLocation();
        });
        elements.tabs.forEach(tab => {
            tab.addEventListener('click', switchTab);
        });
        elements.themeToggle.addEventListener('click', toggleTheme);
        elements.languageToggle.addEventListener('click', toggleLanguage);
        elements.installBtn.addEventListener('click', installPWA);

        // Check for saved theme preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Check for saved language preference
        if (localStorage.getItem('language') === 'bn') {
            isEnglish = false;
            elements.languageToggle.textContent = 'BN';
            updateUIText();
        }

        // Load saved locations
        renderSavedLocations();

        // PWA installation prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            elements.installBtn.style.display = 'flex';
        });

        // Initialize with default location (Dhaka)
        fetchWeather('Dhaka');

        // Functions
        function searchLocation() {
            const location = elements.locationInput.value.trim();
            if (location) {
                fetchWeather(location);
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        fetchWeatherByCoords(latitude, longitude);
                    },
                    (error) => {
                        alert('Unable to retrieve your location. Please enable location services or search manually.');
                        console.error('Geolocation error:', error);
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser. Please search manually.');
            }
        }

        async function fetchWeather(location) {
            try {
                // Show loading state
                elements.location.textContent = 'Loading...';
                
                // First get coordinates from location name
                const geoResponse = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(location)}&count=1`);
                const geoData = await geoResponse.json();
                
                if (!geoData.results || geoData.results.length === 0) {
                    throw new Error('Location not found');
                }
                
                const { latitude, longitude, name, admin1, country } = geoData.results[0];
                currentLocation = { latitude, longitude, name, admin1, country };
                
                // Now fetch weather data
                await fetchWeatherByCoords(latitude, longitude, name);
                
                // Add to saved locations if not already there
                const locationKey = `${name}, ${admin1}, ${country}`;
                if (!savedLocations.some(loc => loc.key === locationKey)) {
                    savedLocations.unshift({
                        key: locationKey,
                        name,
                        admin1,
                        country,
                        latitude,
                        longitude
                    });
                    localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
                    renderSavedLocations();
                }
            } catch (error) {
                console.error('Error fetching weather:', error);
                alert('Failed to fetch weather data. Please try another location.');
                elements.location.textContent = '--';
            }
        }

        async function fetchWeatherByCoords(latitude, longitude, name = null) {
            try {
                // Show loading state
                elements.location.textContent = 'Loading...';
                
                // Fetch weather data from Open-Meteo API
                const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,precipitation,rain,showers,snowfall,weather_code,cloud_cover,pressure_msl,surface_pressure,wind_speed_10m,wind_direction_10m,wind_gusts_10m&hourly=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation_probability,precipitation,rain,showers,snowfall,weather_code,cloud_cover,visibility,wind_speed_10m,wind_direction_10m,wind_gusts_10m,uv_index,is_day&daily=weather_code,temperature_2m_max,temperature_2m_min,apparent_temperature_max,apparent_temperature_min,sunrise,sunset,precipitation_sum,rain_sum,showers_sum,snowfall_sum,precipitation_hours,precipitation_probability_max,wind_speed_10m_max,wind_gusts_10m_max,wind_direction_10m_dominant,uv_index_max&timezone=auto`);
                const weatherData = await weatherResponse.json();
                
                // Fetch air quality data from Open-Meteo API
                const aqiResponse = await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${latitude}&longitude=${longitude}&current=european_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone,uv_index`);
                const aqiData = await aqiResponse.json();
                
                // Process and display data
                displayWeatherData(weatherData, aqiData, name);
                
                // Set background based on weather and time
                setBackground(weatherData.current.weather_code, weatherData.current.is_day);
            } catch (error) {
                console.error('Error fetching weather:', error);
                alert('Failed to fetch weather data. Please try again.');
                elements.location.textContent = '--';
            }
        }

        function displayWeatherData(weatherData, aqiData, customName = null) {
            // Current weather
            const current = weatherData.current;
            const locationName = customName || currentLocation.name;
            const locationStr = `${locationName}, ${currentLocation.admin1 ? currentLocation.admin1 + ', ' : ''}${currentLocation.country}`;
            
            elements.location.textContent = locationStr;
            elements.temperature.textContent = `${current.temperature_2m}°${weatherData.current_units.temperature_2m}`;
            elements.weatherDescription.textContent = getWeatherDescription(current.weather_code, current.is_day);
            elements.humidity.textContent = `${current.relative_humidity_2m}${weatherData.current_units.relative_humidity_2m}`;
            elements.wind.textContent = `${current.wind_speed_10m} ${weatherData.current_units.wind_speed_10m}`;
            elements.windDirection.textContent = getWindDirection(current.wind_direction_10m);
            elements.precipitation.textContent = `${current.precipitation} ${weatherData.current_units.precipitation}`;
            
            // Set weather icon
            setWeatherIcon(current.weather_code, current.is_day);
            
            // Air quality
            const aqi = aqiData.current.european_aqi;
            elements.aqi.innerHTML = `${aqi} <span class="aqi-indicator ${getAqiClass(aqi)}">${getAqiText(aqi)}</span>`;
            
            // UV index
            const uvIndex = aqiData.current.uv_index;
            elements.uvIndex.textContent = `${uvIndex} (${getUvIndexLevel(uvIndex)})`;
            
            // Visibility (convert meters to km)
            const visibility = weatherData.current.visibility ? (weatherData.current.visibility / 1000).toFixed(1) : '--';
            elements.visibility.textContent = `${visibility} km`;
            
            // Sunrise/sunset
            const sunrise = new Date(weatherData.daily.sunrise[0]);
            const sunset = new Date(weatherData.daily.sunset[0]);
            elements.sunTimes.textContent = `${sunrise.getHours().toString().padStart(2, '0')}:${sunrise.getMinutes().toString().padStart(2, '0')} / ${sunset.getHours().toString().padStart(2, '0')}:${sunset.getMinutes().toString().padStart(2, '0')}`;
            
            // Hourly forecast
            renderHourlyForecast(weatherData);
            
            // Daily forecast
            renderDailyForecast(weatherData);
            
            // Health alerts and recommendations
            updateHealthAlerts(aqi, uvIndex, current.weather_code);
            
            // Mood suggestions
            updateMoodSuggestions(current.weather_code, current.temperature_2m);
        }

        function renderHourlyForecast(weatherData) {
            elements.hourlyForecast.innerHTML = '';
            
            const now = new Date();
            const currentHour = now.getHours();
            
            // Show next 24 hours
            for (let i = 0; i < 24; i++) {
                const hourIndex = currentHour + i;
                if (hourIndex >= weatherData.hourly.time.length) break;
                
                const hourData = {
                    time: new Date(weatherData.hourly.time[hourIndex]),
                    temp: weatherData.hourly.temperature_2m[hourIndex],
                    weatherCode: weatherData.hourly.weather_code[hourIndex],
                    precipitation: weatherData.hourly.precipitation_probability[hourIndex],
                    isDay: weatherData.hourly.is_day[hourIndex]
                };
                
                const hourCard = document.createElement('div');
                hourCard.className = 'hour-card';
                hourCard.innerHTML = `
                    <div>${hourData.time.getHours().toString().padStart(2, '0')}:00</div>
                    <div class="weather-icon-small">${getWeatherIcon(hourData.weatherCode, hourData.isDay)}</div>
                    <div>${hourData.temp}°</div>
                    <div><i class="fas fa-tint"></i> ${hourData.precipitation}%</div>
                `;
                
                elements.hourlyForecast.appendChild(hourCard);
            }
            
            // Update chart
            updateChart(weatherData);
        }

        function renderDailyForecast(weatherData) {
            elements.dailyForecast.innerHTML = '';
            
            for (let i = 0; i < weatherData.daily.time.length; i++) {
                const dayData = {
                    date: new Date(weatherData.daily.time[i]),
                    maxTemp: weatherData.daily.temperature_2m_max[i],
                    minTemp: weatherData.daily.temperature_2m_min[i],
                    weatherCode: weatherData.daily.weather_code[i],
                    precipitation: weatherData.daily.precipitation_probability_max[i]
                };
                
                const dayName = dayData.date.toLocaleDateString(isEnglish ? 'en-US' : 'bn-BD', { weekday: 'short' });
                const dateStr = dayData.date.getDate();
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.innerHTML = `
                    <div>${isEnglish ? dayName : convertToBanglaDay(dayName)}</div>
                    <div>${isEnglish ? dateStr : convertToBanglaNumber(dateStr)}</div>
                    <div class="weather-icon-small">${getWeatherIcon(dayData.weatherCode, true)}</div>
                    <div>${dayData.maxTemp}° / ${dayData.minTemp}°</div>
                    <div><i class="fas fa-tint"></i> ${dayData.precipitation}%</div>
                `;
                
                elements.dailyForecast.appendChild(dayCard);
            }
        }

        function updateChart(weatherData) {
            const ctx = document.getElementById('weather-chart').getContext('2d');
            
            // Prepare data for chart
            const now = new Date();
            const currentHour = now.getHours();
            const hours = [];
            const temps = [];
            const precipitations = [];
            
            // Get next 24 hours data
            for (let i = 0; i < 24; i++) {
                const hourIndex = currentHour + i;
                if (hourIndex >= weatherData.hourly.time.length) break;
                
                hours.push(new Date(weatherData.hourly.time[hourIndex]).getHours().toString().padStart(2, '0') + ':00');
                temps.push(weatherData.hourly.temperature_2m[hourIndex]);
                precipitations.push(weatherData.hourly.precipitation_probability[hourIndex]);
            }
            
            // Destroy previous chart if exists
            if (weatherChart) {
                weatherChart.destroy();
            }
            
            // Create new chart
            weatherChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: 'Temperature (°C)',
                            data: temps,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Precipitation (%)',
                            data: precipitations,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderWidth: 2,
                            yAxisID: 'y1',
                            type: 'bar'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Temperature (°C)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            max: 100,
                            min: 0,
                            title: {
                                display: true,
                                text: 'Precipitation (%)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        function updateHealthAlerts(aqi, uvIndex, weatherCode) {
            elements.healthAlerts.innerHTML = '';
            
            // AQI alerts
            let aqiAlertClass = '';
            let aqiAlertText = '';
            
            if (aqi <= 20) {
                aqiAlertClass = 'alert-success';
                aqiAlertText = isEnglish 
                    ? 'Air quality is excellent. Perfect for outdoor activities!' 
                    : 'বাতাসের মান চমৎকার। বাইরে যাওয়ার জন্য উপযুক্ত সময়!';
            } else if (aqi <= 40) {
                aqiAlertClass = 'alert-success';
                aqiAlertText = isEnglish 
                    ? 'Air quality is good. No health impacts expected.' 
                    : 'বাতাসের মান ভালো। স্বাস্থ্যের জন্য ঝুঁকি নেই।';
            } else if (aqi <= 60) {
                aqiAlertClass = '';
                aqiAlertText = isEnglish 
                    ? 'Air quality is acceptable. Unusually sensitive people should consider reducing prolonged outdoor exertion.' 
                    : 'বাতাসের মান সহনীয়। সংবেদনশীল ব্যক্তিদের দীর্ঘসময় বাইরে থাকা কমাতে হবে।';
            } else if (aqi <= 80) {
                aqiAlertClass = 'health-alert';
                aqiAlertText = isEnglish 
                    ? 'Air quality is moderately polluted. Children and people with respiratory diseases should avoid prolonged outdoor exertion.' 
                    : 'বাতাসের মান মাঝারি মাত্রার দূষিত। শিশু ও শ্বাসকষ্টের রোগীদের দীর্ঘসময় বাইরে থাকা এড়ানো উচিত।';
            } else if (aqi <= 100) {
                aqiAlertClass = 'health-alert';
                aqiAlertText = isEnglish 
                    ? 'Air quality is poor. Everyone may begin to experience health effects.' 
                    : 'বাতাসের মান খারাপ। সকলেরই স্বাস্থ্যগত সমস্যা দেখা দিতে পারে।';
            } else {
                aqiAlertClass = 'alert-danger';
                aqiAlertText = isEnglish 
                    ? 'Air quality is very poor. Health alert: everyone may experience more serious health effects.' 
                    : 'বাতাসের মান খুবই খারাপ। স্বাস্থ্য সতর্কতা: সকলেরই গুরুতর স্বাস্থ্যগত সমস্যা দেখা দিতে পারে।';
            }
            
            const aqiAlert = document.createElement('div');
            aqiAlert.className = `health-alert ${aqiAlertClass}`;
            aqiAlert.innerHTML = `<i class="fas fa-lungs"></i> ${aqiAlertText}`;
            elements.healthAlerts.appendChild(aqiAlert);
            
            // UV index alerts
            let uvAlertClass = '';
            let uvAlertText = '';
            
            if (uvIndex >= 8) {
                uvAlertClass = 'alert-danger';
                uvAlertText = isEnglish 
                    ? 'UV Index is very high. Avoid sun exposure between 10am-4pm. Apply SPF 30+ sunscreen every 2 hours.' 
                    : 'UV সূচক খুবই উচ্চ। সকাল ১০টা থেকে বিকাল ৪টা পর্যন্ত রোদ এড়িয়ে চলুন। SPF ৩০+ সানস্ক্রিন প্রতি ২ ঘন্টা পর পর ব্যবহার করুন।';
            } else if (uvIndex >= 6) {
                uvAlertClass = 'health-alert';
                uvAlertText = isEnglish 
                    ? 'UV Index is high. Wear sunscreen SPF 30+, a hat, and sunglasses.' 
                    : 'UV সূচক উচ্চ। SPF ৩০+ সানস্ক্রিন, টুপি ও সানগ্লাস ব্যবহার করুন।';
            } else if (uvIndex >= 3) {
                uvAlertClass = '';
                uvAlertText = isEnglish 
                    ? 'UV Index is moderate. Wear sunscreen if you will be outside.' 
                    : 'UV সূচক মাঝারি। বাইরে থাকলে সানস্ক্রিন ব্যবহার করুন।';
            } else {
                uvAlertClass = 'alert-success';
                uvAlertText = isEnglish 
                    ? 'UV Index is low. No protection needed.' 
                    : 'UV সূচক কম। সুরক্ষার প্রয়োজন নেই।';
            }
            
            const uvAlert = document.createElement('div');
            uvAlert.className = `health-alert ${uvAlertClass}`;
            uvAlert.innerHTML = `<i class="fas fa-sun"></i> ${uvAlertText}`;
            elements.healthAlerts.appendChild(uvAlert);
            
            // Weather-specific alerts
            if ([71, 73, 75, 77, 85, 86].includes(weatherCode)) { // Snow codes
                const snowAlert = document.createElement('div');
                snowAlert.className = 'health-alert';
                snowAlert.innerHTML = `<i class="fas fa-snowflake"></i> ${
                    isEnglish 
                        ? 'Snow expected. Drive carefully and dress warmly.' 
                        : 'তুষারপাতের সম্ভাবনা। সাবধানে গাড়ি চালান ও গরম কাপড় পরুন।'
                }`;
                elements.healthAlerts.appendChild(snowAlert);
            }
            
            if ([95, 96, 99].includes(weatherCode)) { // Thunderstorm codes
                const stormAlert = document.createElement('div');
                stormAlert.className = 'alert-danger';
                stormAlert.innerHTML = `<i class="fas fa-bolt"></i> ${
                    isEnglish 
                        ? 'Thunderstorm expected. Stay indoors if possible.' 
                        : 'বজ্রবৃষ্টির সম্ভাবনা। সম্ভব হলে ঘরের ভিতরে থাকুন।'
                }`;
                elements.healthAlerts.appendChild(stormAlert);
            }
            
            // Update health recommendations
            let recommendations = '';
            if (aqi > 60) {
                recommendations += isEnglish 
                    ? `<p><i class="fas fa-mask"></i> Wear a mask when going outside.</p>` 
                    : `<p><i class="fas fa-mask"></i> বাইরে গেলে মাস্ক পরুন।</p>`;
                recommendations += isEnglish 
                    ? `<p><i class="fas fa-window-close"></i> Keep windows closed to prevent polluted air from entering.</p>` 
                    : `<p><i class="fas fa-window-close"></i> দূষিত বাতাস ঢুকতে দেবেন না, জানালা বন্ধ রাখুন।</p>`;
            } else {
                recommendations += isEnglish 
                    ? `<p><i class="fas fa-tree"></i> Air quality is good. Great time for outdoor activities.</p>` 
                    : `<p><i class="fas fa-tree"></i> বাতাসের মান ভালো। বাইরে বের হওয়ার জন্য ভালো সময়।</p>`;
            }
            
            elements.healthRecommendations.innerHTML = recommendations;
            
            // Update skin care tips
            let skinTips = '';
            if (uvIndex >= 6) {
                skinTips += isEnglish 
                    ? `<p><i class="fas fa-sun"></i> Apply SPF 30+ sunscreen every 2 hours.</p>` 
                    : `<p><i class="fas fa-sun"></i> SPF ৩০+ সানস্ক্রিন প্রতি ২ ঘন্টা পর পর ব্যবহার করুন।</p>`;
                skinTips += isEnglish 
                    ? `<p><i class="fas fa-umbrella-beach"></i> Seek shade between 10am-4pm when UV is strongest.</p>` 
                    : `<p><i class="fas fa-umbrella-beach"></i> সকাল ১০টা থেকে বিকাল ৪টা পর্যন্ত ছায়ায় থাকুন যখন UV সবচেয়ে শক্তিশালী।</p>`;
            } else if (uvIndex >= 3) {
                skinTips += isEnglish 
                    ? `<p><i class="fas fa-sun"></i> Apply SPF 15+ sunscreen if you'll be outside for more than 30 minutes.</p>` 
                    : `<p><i class="fas fa-sun"></i> ৩০ মিনিটের বেশি বাইরে থাকলে SPF ১৫+ সানস্ক্রিন ব্যবহার করুন।</p>`;
            } else {
                skinTips += isEnglish 
                    ? `<p><i class="fas fa-smile"></i> UV index is low. No special protection needed.</p>` 
                    : `<p><i class="fas fa-smile"></i> UV সূচক কম। বিশেষ সুরক্ষার প্রয়োজন নেই।</p>`;
            }
            
            elements.skinCareTips.innerHTML = skinTips;
        }

        function updateMoodSuggestions(weatherCode, temperature) {
            let suggestions = '';
            
            if ([0, 1].includes(weatherCode)) { // Clear or mostly clear
                if (temperature > 25) {
                    suggestions = isEnglish 
                        ? "It's a beautiful sunny day! Perfect for beach trips, picnics, or outdoor sports." 
                        : "এটা একটা চমৎকার রৌদ্রোজ্জ্বল দিন! সমুদ্র সৈকত, পিকনিক বা বাইরের খেলাধুলার জন্য উপযুক্ত সময়।";
                } else if (temperature > 15) {
                    suggestions = isEnglish 
                        ? "Lovely weather for a walk in the park or reading a book outside." 
                        : "পার্কে হাঁটাহাঁটি বা বাইরে বই পড়ার জন্য চমৎকার আবহাওয়া।";
                } else {
                    suggestions = isEnglish 
                        ? "Crisp and clear. Great for a warm drink by the window." 
                        : "সতেজ ও পরিষ্কার আবহাওয়া। জানালার পাশে গরম পানীয় উপভোগ করার জন্য ভালো সময়।";
                }
            } else if ([2, 3].includes(weatherCode)) { // Partly cloudy
                suggestions = isEnglish 
                    ? "Partly cloudy skies. Good day for both indoor and outdoor activities." 
                    : "আংশিক মেঘলা আকাশ। ঘরে ও বাইরে উভয় ধরনের কাজের জন্য ভালো দিন।";
            } else if ([45, 48].includes(weatherCode)) { // Fog
                suggestions = isEnglish 
                    ? "Foggy conditions. Cozy up with a book or movie indoors." 
                    : "কুয়াশাচ্ছন্ন আবহাওয়া। ঘরে বই পড়া বা সিনেমা দেখার জন্য ভালো সময়।";
            } else if ([51, 53, 55, 56, 57].includes(weatherCode)) { // Drizzle
                suggestions = isEnglish 
                    ? "Light rain outside. Perfect for making tea and enjoying some quiet time." 
                    : "বাইরে হালকা বৃষ্টি। চা বানিয়ে শান্ত সময় উপভোগ করার জন্য উপযুক্ত সময়।";
            } else if ([61, 63, 65, 66, 67].includes(weatherCode)) { // Rain
                suggestions = isEnglish 
                    ? "Rainy day ahead. Great for indoor activities like baking or board games." 
                    : "বৃষ্টির দিন। বেকিং বা বোর্ড গেমের মতো ঘরের কাজের জন্য ভালো সময়।";
            } else if ([71, 73, 75, 77, 85, 86].includes(weatherCode)) { // Snow
                suggestions = isEnglish 
                    ? "Snowy weather! Time for hot chocolate and cozy blankets." 
                    : "তুষারপাত হচ্ছে! হট চকলেট আর গরম কম্বলের সময়।";
            } else if ([95, 96, 99].includes(weatherCode)) { // Thunderstorm
                suggestions = isEnglish 
                    ? "Stormy weather. Stay safe indoors with a good book or movie." 
                    : "ঝড়ো আবহাওয়া। নিরাপদে ঘরে থাকুন, ভালো বই বা সিনেমা দেখুন।";
            } else {
                suggestions = isEnglish 
                    ? "Enjoy your day! Check back for weather updates." 
                    : "আপনার দিনটি ভালো কাটুক! আবহাওয়ার আপডেটের জন্য চেক করুন।";
            }
            
            elements.moodSuggestions.innerHTML = `<p>${suggestions}</p>`;
        }

        function renderSavedLocations() {
            elements.savedCities.innerHTML = '';
            
            savedLocations.forEach(location => {
                const cityChip = document.createElement('div');
                cityChip.className = 'city-chip';
                cityChip.textContent = location.key;
                
                const closeBtn = document.createElement('span');
                closeBtn.className = 'close';
                closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                closeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeSavedLocation(location.key);
                });
                
                cityChip.appendChild(closeBtn);
                cityChip.addEventListener('click', () => {
                    fetchWeatherByCoords(location.latitude, location.longitude, location.name);
                });
                
                elements.savedCities.appendChild(cityChip);
            });
        }

        function removeSavedLocation(locationKey) {
            savedLocations = savedLocations.filter(loc => loc.key !== locationKey);
            localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
            renderSavedLocations();
        }

        function switchTab(e) {
            const tab = e.target;
            const tabName = tab.dataset.tab;
            
            // Update active tab
            elements.tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Show corresponding content
            if (tabName === 'hourly') {
                elements.hourlyForecast.style.display = 'flex';
                elements.dailyForecast.style.display = 'none';
                elements.forecastTitle.textContent = isEnglish ? 'Hourly Forecast' : 'প্রতি ঘন্টার পূর্বাভাস';
            } else {
                elements.hourlyForecast.style.display = 'none';
                elements.dailyForecast.style.display = 'grid';
                elements.forecastTitle.textContent = isEnglish ? 'Daily Forecast' : 'দৈনিক পূর্বাভাস';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            if (isDark) {
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        function toggleLanguage() {
            isEnglish = !isEnglish;
            localStorage.setItem('language', isEnglish ? 'en' : 'bn');
            elements.languageToggle.textContent = isEnglish ? 'EN' : 'BN';
            updateUIText();
            
            // Refresh weather data to update language
            if (currentLocation) {
                fetchWeatherByCoords(currentLocation.latitude, currentLocation.longitude, currentLocation.name);
            }
        }

        function updateUIText() {
            elements.appTitle.textContent = isEnglish ? 'Weather & Air Quality Checker' : 'আবহাওয়া ও বায়ুর মান পরীক্ষক';
            elements.locationInput.placeholder = isEnglish ? 'Enter city name or zip code' : 'শহরের নাম বা পোস্ট কোড লিখুন';
            elements.searchBtn.innerHTML = isEnglish ? '<i class="fas fa-search"></i> Search' : '<i class="fas fa-search"></i> খুঁজুন';
            elements.locateBtn.innerHTML = isEnglish ? '<i class="fas fa-location-arrow"></i> Current Location' : '<i class="fas fa-location-arrow"></i> বর্তমান অবস্থান';
            elements.forecastTitle.textContent = isEnglish ? 'Hourly Forecast' : 'প্রতি ঘন্টার পূর্বাভাস';
            
            // Update tab text
            elements.tabs[0].textContent = isEnglish ? 'Hourly' : 'প্রতি ঘন্টা';
            elements.tabs[1].textContent = isEnglish ? 'Daily' : 'দৈনিক';
            
            // Update saved locations title
            document.querySelector('.saved-cities-container h2').textContent = isEnglish ? 'Saved Locations' : 'সংরক্ষিত অবস্থানসমূহ';
            
            // Update additional info titles
            document.querySelectorAll('.info-card h3')[0].textContent = isEnglish ? 'Health Recommendations' : 'স্বাস্থ্য পরামর্শ';
            document.querySelectorAll('.info-card h3')[1].textContent = isEnglish ? 'Skin Care Tips' : 'ত্বকের যত্ন পরামর্শ';
            document.querySelectorAll('.info-card h3')[2].textContent = isEnglish ? 'Mood Suggestions' : 'মুড সাজেশন';
        }

        function setWeatherIcon(weatherCode, isDay) {
            elements.weatherIcon.innerHTML = getWeatherIcon(weatherCode, isDay);
        }

        function getWeatherIcon(weatherCode, isDay) {
            // Weather codes from Open-Meteo API
            if (weatherCode === 0) {
                return isDay ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>'; // Clear
            } else if (weatherCode === 1 || weatherCode === 2) {
                return isDay ? '<i class="fas fa-cloud-sun"></i>' : '<i class="fas fa-cloud-moon"></i>'; // Mainly clear, partly cloudy
            } else if (weatherCode === 3) {
                return '<i class="fas fa-cloud"></i>'; // Overcast
            } else if (weatherCode === 45 || weatherCode === 48) {
                return '<i class="fas fa-smog"></i>'; // Fog
            } else if (weatherCode === 51 || weatherCode === 53 || weatherCode === 55) {
                return '<i class="fas fa-cloud-rain"></i>'; // Drizzle
            } else if (weatherCode === 56 || weatherCode === 57) {
                return '<i class="fas fa-cloud-meatball"></i>'; // Freezing drizzle
            } else if (weatherCode === 61 || weatherCode === 63 || weatherCode === 65) {
                return '<i class="fas fa-cloud-showers-heavy"></i>'; // Rain
            } else if (weatherCode === 66 || weatherCode === 67) {
                return '<i class="fas fa-cloud-meatball"></i>'; // Freezing rain
            } else if (weatherCode === 71 || weatherCode === 73 || weatherCode === 75) {
                return '<i class="fas fa-snowflake"></i>'; // Snow
            } else if (weatherCode === 77) {
                return '<i class="fas fa-snowflake"></i>'; // Snow grains
            } else if (weatherCode === 80 || weatherCode === 81 || weatherCode === 82) {
                return '<i class="fas fa-cloud-showers-heavy"></i>'; // Rain showers
            } else if (weatherCode === 85 || weatherCode === 86) {
                return '<i class="fas fa-snowflake"></i>'; // Snow showers
            } else if (weatherCode === 95 || weatherCode === 96 || weatherCode === 99) {
                return '<i class="fas fa-bolt"></i>'; // Thunderstorm
            } else {
                return '<i class="fas fa-question"></i>'; // Unknown
            }
        }

        function getWeatherDescription(weatherCode, isDay) {
            // English descriptions
            const descriptions = {
                0: isDay ? 'Clear sky' : 'Clear night',
                1: isDay ? 'Mainly clear' : 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Fog',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                53: 'Moderate drizzle',
                55: 'Dense drizzle',
                56: 'Light freezing drizzle',
                57: 'Dense freezing drizzle',
                61: 'Slight rain',
                63: 'Moderate rain',
                65: 'Heavy rain',
                66: 'Light freezing rain',
                67: 'Heavy freezing rain',
                71: 'Slight snow fall',
                73: 'Moderate snow fall',
                75: 'Heavy snow fall',
                77: 'Snow grains',
                80: 'Slight rain showers',
                81: 'Moderate rain showers',
                82: 'Violent rain showers',
                85: 'Slight snow showers',
                86: 'Heavy snow showers',
                95: 'Thunderstorm',
                96: 'Thunderstorm with slight hail',
                99: 'Thunderstorm with heavy hail'
            };
            
            // Bangla descriptions
            const banglaDescriptions = {
                0: isDay ? 'পরিষ্কার আকাশ' : 'পরিষ্কার রাত',
                1: isDay ? 'প্রধানত পরিষ্কার' : 'প্রধানত পরিষ্কার',
                2: 'আংশিক মেঘলা',
                3: 'ঘন মেঘ',
                45: 'কুয়াশা',
                48: 'তুষার কুয়াশা',
                51: 'হালকা গুঁড়ি গুঁড়ি বৃষ্টি',
                53: 'মাঝারি গুঁড়ি গুঁড়ি বৃষ্টি',
                55: 'ঘন গুঁড়ি গুঁড়ি বৃষ্টি',
                56: 'হালকা হিম বৃষ্টি',
                57: 'ঘন হিম বৃষ্টি',
                61: 'হালকা বৃষ্টি',
                63: 'মাঝারি বৃষ্টি',
                65: 'অতিভারী বৃষ্টি',
                66: 'হালকা হিম বৃষ্টি',
                67: 'অতিভারী হিম বৃষ্টি',
                71: 'হালকা তুষারপাত',
                73: 'মাঝারি তুষারপাত',
                75: 'অতিভারী তুষারপাত',
                77: 'তুষার কণা',
                80: 'হালকা বৃষ্টিস্নাত',
                81: 'মাঝারি বৃষ্টিস্নাত',
                82: 'অতিভারী বৃষ্টিস্নাত',
                85: 'হালকা তুষারস্নাত',
                86: 'অতিভারী তুষারস্নাত',
                95: 'বজ্রবৃষ্টি',
                96: 'হালকা শিলাবৃষ্টিসহ বজ্রবৃষ্টি',
                99: 'অতিভারী শিলাবৃষ্টিসহ বজ্রবৃষ্টি'
            };
            
            return isEnglish ? descriptions[weatherCode] || 'Unknown' : banglaDescriptions[weatherCode] || 'অজানা';
        }

        function getWindDirection(degrees) {
            if (degrees >= 337.5 || degrees < 22.5) return isEnglish ? 'North' : 'উত্তর';
            if (degrees >= 22.5 && degrees < 67.5) return isEnglish ? 'Northeast' : 'উত্তর-পূর্ব';
            if (degrees >= 67.5 && degrees < 112.5) return isEnglish ? 'East' : 'পূর্ব';
            if (degrees >= 112.5 && degrees < 157.5) return isEnglish ? 'Southeast' : 'দক্ষিণ-পূর্ব';
            if (degrees >= 157.5 && degrees < 202.5) return isEnglish ? 'South' : 'দক্ষিণ';
            if (degrees >= 202.5 && degrees < 247.5) return isEnglish ? 'Southwest' : 'দক্ষিণ-পশ্চিম';
            if (degrees >= 247.5 && degrees < 292.5) return isEnglish ? 'West' : 'পশ্চিম';
            if (degrees >= 292.5 && degrees < 337.5) return isEnglish ? 'Northwest' : 'উত্তর-পশ্চিম';
            return isEnglish ? 'Variable' : 'পরিবর্তনশীল';
        }

        function getAqiClass(aqi) {
            if (aqi <= 20) return 'aqi-good';
            if (aqi <= 40) return 'aqi-good';
            if (aqi <= 60) return 'aqi-moderate';
            if (aqi <= 80) return 'aqi-moderate';
            if (aqi <= 100) return 'aqi-unhealthy';
            return 'aqi-unhealthy';
        }

        function getAqiText(aqi) {
            if (aqi <= 20) return isEnglish ? 'Excellent' : 'চমৎকার';
            if (aqi <= 40) return isEnglish ? 'Good' : 'ভালো';
            if (aqi <= 60) return isEnglish ? 'Acceptable' : 'সহনীয়';
            if (aqi <= 80) return isEnglish ? 'Moderate' : 'মাঝারি';
            if (aqi <= 100) return isEnglish ? 'Poor' : 'খারাপ';
            return isEnglish ? 'Very Poor' : 'খুবই খারাপ';
        }

        function getUvIndexLevel(uvIndex) {
            if (uvIndex <= 2) return isEnglish ? 'Low' : 'নিম্ন';
            if (uvIndex <= 5) return isEnglish ? 'Moderate' : 'মাঝারি';
            if (uvIndex <= 7) return isEnglish ? 'High' : 'উচ্চ';
            if (uvIndex <= 10) return isEnglish ? 'Very High' : 'অত্যধিক';
            return isEnglish ? 'Extreme' : 'চরম';
        }

        function setBackground(weatherCode, isDay) {
            // Remove all weather background classes
            elements.body.className = '';
            
            if (!isDay) {
                elements.body.classList.add('weather-bg-night');
                return;
            }
            
            if (weatherCode === 0) {
                elements.body.classList.add('weather-bg-clear');
            } else if (weatherCode === 1 || weatherCode === 2 || weatherCode === 3) {
                elements.body.classList.add('weather-bg-clouds');
            } else if (weatherCode >= 51 && weatherCode <= 67 || weatherCode >= 80 && weatherCode <= 82) {
                elements.body.classList.add('weather-bg-rain');
            } else if (weatherCode >= 71 && weatherCode <= 77 || weatherCode >= 85 && weatherCode <= 86) {
                elements.body.classList.add('weather-bg-snow');
            } else if (weatherCode >= 95 && weatherCode <= 99) {
                elements.body.classList.add('weather-bg-thunderstorm');
            } else if (weatherCode === 45 || weatherCode === 48) {
                elements.body.classList.add('weather-bg-mist');
            } else {
                elements.body.classList.add('weather-bg-clear');
            }
        }

        function convertToBanglaNumber(num) {
            const banglaDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
            return num.toString().split('').map(d => banglaDigits[parseInt(d)]).join('');
        }

        function convertToBanglaDay(day) {
            const days = {
                'Sun': 'রবি',
                'Mon': 'সোম',
                'Tue': 'মঙ্গল',
                'Wed': 'বুধ',
                'Thu': 'বৃহস্পতি',
                'Fri': 'শুক্র',
                'Sat': 'শনি'
            };
            return days[day] || day;
        }

        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    elements.installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        }

        // Service worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
